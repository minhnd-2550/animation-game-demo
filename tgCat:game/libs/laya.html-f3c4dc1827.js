!function(t,a){"use strict";class e{constructor(){this.reset()}reset(){return this.stroke=0,this.strokeColor="#000000",this.leading=0,this.lineHeight=0,this.letterSpacing=0,this.href=null,this}recover(){this!=e.EMPTY&&a.Pool.recover("HTMLExtendStyle",this.reset())}static create(){return a.Pool.getItemByClass("HTMLExtendStyle",e)}}e.EMPTY=new e,a.ClassUtils.regClass("laya.html.utils.HTMLExtendStyle",e),a.ClassUtils.regClass("Laya.HTMLExtendStyle",e);class D{constructor(){this.padding=D._PADDING,this.reset()}_getExtendStyle(){return this._extendStyle===e.EMPTY&&(this._extendStyle=e.create()),this._extendStyle}get href(){return this._extendStyle.href}set href(t){t!==this._extendStyle.href&&(this._getExtendStyle().href=t)}get stroke(){return this._extendStyle.stroke}set stroke(t){this._extendStyle.stroke!==t&&(this._getExtendStyle().stroke=t)}get strokeColor(){return this._extendStyle.strokeColor}set strokeColor(t){this._extendStyle.strokeColor!==t&&(this._getExtendStyle().strokeColor=t)}get leading(){return this._extendStyle.leading}set leading(t){this._extendStyle.leading!==t&&(this._getExtendStyle().leading=t)}get lineHeight(){return this._extendStyle.lineHeight}set lineHeight(t){this._extendStyle.lineHeight!==t&&(this._getExtendStyle().lineHeight=t)}set align(t){t in D.alignVDic&&(this._type&=~D._ALIGN,this._type|=D.alignVDic[t])}get align(){var t=this._type&D._ALIGN;return D.align_Value[t]}set valign(t){t in D.alignVDic&&(this._type&=~D._VALIGN,this._type|=D.alignVDic[t])}get valign(){var t=this._type&D._VALIGN;return D.vAlign_Value[t]}set font(t){for(var e=t.split(" "),s=0,i=e.length;s<i;s++){var r=e[s];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}0<r.indexOf("px")&&(this.fontSize=parseInt(r),this.family=e[s+1],s++)}}get font(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(a.ILaya.Browser.onIPhone&&a.ILaya.Text.fontFamilyMap[this.family]||this.family)}set block(t){t?this._type|=D._CSS_BLOCK:this._type&=~D._CSS_BLOCK}get block(){return 0!=(this._type&D._CSS_BLOCK)}reset(){return this.ower=null,this._type=0,this.wordWrap=!0,this.fontSize=a.ILaya.Text.defaultFontSize,this.family=a.ILaya.Text.defaultFont,this.color="#000000",this.valign=D.VALIGN_TOP,this.padding=D._PADDING,this.bold=!1,this.italic=!1,this.align=D.ALIGN_LEFT,this.textDecoration=null,this.bgColor=null,this.borderColor=null,this._extendStyle&&this._extendStyle.recover(),this._extendStyle=e.EMPTY,this}recover(){a.Pool.recover("HTMLStyle",this.reset())}static create(){return a.Pool.getItemByClass("HTMLStyle",D)}inherit(t){for(var e,s=D._inheritProps,i=s.length,r=0;r<i;r++)this[e=s[r]]=t[e]}get wordWrap(){return 0==(this._type&D._NOWARP)}set wordWrap(t){t?this._type&=~D._NOWARP:this._type|=D._NOWARP}get bold(){return 0!=(this._type&D._BOLD)}set bold(t){t?this._type|=D._BOLD:this._type&=~D._BOLD}get fontWeight(){return this._type&D._BOLD?"bold":"none"}set fontWeight(t){"bold"==t?this._type|=D._BOLD:this._type&=~D._BOLD}get italic(){return 0!=(this._type&D._ITALIC)}set italic(t){t?this._type|=D._ITALIC:this._type&=~D._ITALIC}_widthAuto(){return 0!=(this._type&D._WIDTHAUTO)}widthed(t){return 0!=(this._type&D._WIDTH_SET)}set whiteSpace(t){"nowrap"===t&&(this._type|=D._NOWARP),"none"===t&&(this._type&=~D._NOWARP)}get whiteSpace(){return this._type&D._NOWARP?"nowrap":""}_calculation(t,e){return!1}set width(t){if(this._type|=D._WIDTH_SET,"string"==typeof t){var e=t.indexOf("auto");if(0<=e&&(this._type|=D._WIDTHAUTO,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}set height(t){if(this._type|=D._HEIGHT_SET,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}heighted(t){return 0!=(this._type&D._HEIGHT_SET)}size(t,e){var s=this.ower,i=!1;-1!==t&&t!=s.width&&(this._type|=D._WIDTH_SET,s.width=t,i=!0),-1!==e&&e!=s.height&&(this._type|=D._HEIGHT_SET,s.height=e,i=!0),i&&s._layoutLater()}getLineElement(){return 0!=(this._type&D._LINE_ELEMENT)}setLineElement(t){t?this._type|=D._LINE_ELEMENT:this._type&=~D._LINE_ELEMENT}_enableLayout(){return 0==(this._type&D._DISPLAY_NONE)&&0==(this._type&D._ABSOLUTE)}get letterSpacing(){return this._extendStyle.letterSpacing}set letterSpacing(t){(t="string"==typeof t?parseInt(t+""):t)!=this._extendStyle.letterSpacing&&(this._getExtendStyle().letterSpacing=t)}cssText(t){this.attrs(D.parseOneCSS(t,";"))}attrs(t){if(t)for(var e=0,s=t.length;e<s;e++){var i=t[e];this[i[0]]=i[1]}}set position(t){"absolute"===t?this._type|=D._ABSOLUTE:this._type&=~D._ABSOLUTE}get position(){return this._type&D._ABSOLUTE?"absolute":""}get absolute(){return 0!=(this._type&D._ABSOLUTE)}get paddingLeft(){return this.padding[3]}get paddingTop(){return this.padding[0]}static parseOneCSS(t,e){for(var s,i=[],r=t.split(e),h=0,l=r.length;h<l;h++){var a=r[h],n=a.indexOf(":"),o=a.substr(0,n).replace(/^\s+|\s+$/g,"");if(0!==o.length){var _=a.substr(n+1).replace(/^\s+|\s+$/g,""),d=[o,_];switch(o){case"italic":case"bold":d[1]="true"==_;break;case"font-weight":"bold"==_&&(d[1]=!0,d[0]="bold");break;case"line-height":d[0]="lineHeight",d[1]=parseInt(_);break;case"font-size":d[0]="fontSize",d[1]=parseInt(_);break;case"stroke":d[0]="stroke",d[1]=parseInt(_);break;case"padding":1<(s=_.split(" ")).length||(s[1]=s[2]=s[3]=s[0]),d[1]=[parseInt(s[0]),parseInt(s[1]),parseInt(s[2]),parseInt(s[3])];break;default:(d[0]=D._CSSTOVALUE[o])||(d[0]=o)}i.push(d)}}return i}static parseCSS(t,e){for(var s;null!=(s=D._parseCSSRegExp.exec(t));)D.styleSheets[s[1]]=D.parseOneCSS(s[2],";")}}D._CSSTOVALUE={"letter-spacing":"letterSpacing","white-space":"whiteSpace","line-height":"lineHeight","font-family":"family","vertical-align":"valign","text-decoration":"textDecoration","background-color":"bgColor","border-color":"borderColor"},D._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),D._inheritProps=["italic","align","valign","leading","letterSpacing","stroke","strokeColor","bold","fontWeight","fontSize","lineHeight","wordWrap","color"],D.ALIGN_LEFT="left",D.ALIGN_CENTER="center",D.ALIGN_RIGHT="right",D.VALIGN_TOP="top",D.VALIGN_MIDDLE="middle",D.VALIGN_BOTTOM="bottom",D.styleSheets={},D.ADDLAYOUTED=512,D._PADDING=[0,0,0,0],D._HEIGHT_SET=8192,D._LINE_ELEMENT=65536,D._NOWARP=131072,D._WIDTHAUTO=262144,D._BOLD=1024,D._ITALIC=2048,D._CSS_BLOCK=1,D._DISPLAY_NONE=2,D._ABSOLUTE=4,D._WIDTH_SET=8,D.alignVDic={left:0,center:16,right:32,top:0,middle:64,bottom:128},D.align_Value={0:"left",16:"center",32:"right"},D.vAlign_Value={0:"top",64:"middle",128:"bottom"},D._ALIGN=48,D._VALIGN=192,a.ClassUtils.regClass("laya.html.utils.HTMLStyle",D),a.ClassUtils.regClass("Laya.HTMLStyle",D);class s{constructor(){this.all={},this.styleSheets=D.styleSheets}getElementById(t){return this.all[t]}setElementById(t,e){this.all[t]=e}}s.document=new s,a.ClassUtils.regClass("laya.html.dom.HTMLDocument",s),a.ClassUtils.regClass("Laya.HTMLDocument",s);class _{constructor(){this.rec=new a.Rectangle,this.reset()}reset(){return this.rec.reset(),this.href=null,this}recover(){a.Pool.recover("HTMLHitRect",this.reset())}static create(){return a.Pool.getItemByClass("HTMLHitRect",_)}}a.ClassUtils.regClass("laya.html.dom.HTMLHitRect",_),a.ClassUtils.regClass("Laya.HTMLHitRect",_);class A{}A.HTMLDivElement=null,A.HTMLImageElement=null,A.HTMLBrElement=null,A.HTMLDivParser=null,A.HTMLParse=null,A.HTMLElementType=null;class R{constructor(){this.elements=[],this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0}updatePos(t,e,s,i,r,h,l){var a=0,n=(0<this.elements.length&&(a=(d=this.elements[this.elements.length-1]).x+d.width-this.elements[0].x),l=l||this.h,0);r===D.ALIGN_CENTER&&(n=(e-a)/2),r===D.ALIGN_RIGHT&&(n=e-a);for(var o=0,_=this.elements.length;o<_;o++){var d,g=(d=this.elements[o])._getCSSStyle();switch(0!==n&&(d.x+=n),g.valign){case"top":d.y=i;break;case"middle":var c=0,c=((c=99999!=this.minTextHeight?this.minTextHeight:c)+l)/2,c=Math.max(c,this.h),c=(d.eletype,A.HTMLElementType.IMAGE,i+c-d.height);d.y=c;break;case"bottom":d.y=i+(l-d.height)}}}}a.ClassUtils.regClass("laya.html.utils.LayoutLine",R),a.ClassUtils.regClass("Laya.LayoutLine",R);class P{static later(t){null==P._will&&(P._will=[],a.ILaya.stage.frameLoop(1,null,function(){if(!(P._will.length<1)){for(var t=0;t<P._will.length;t++)P.layout(P._will[t]);P._will.length=0}})),P._will.push(t)}static layout(t){return!t||!t._style||0==(t._style._type&D.ADDLAYOUTED)?null:(t.style._type&=~D.ADDLAYOUTED,P._multiLineLayout(t))}static _multiLineLayout(t){var e=[];t._addChildsToLayout(e);var s,i,r,h,l,a=e.length,n=t._getCSSStyle(),o=n.letterSpacing,_=n.leading,d=n.lineHeight,g=n._widthAuto()||!n.wordWrap,c=g?999999:t.width,y=(t.height,0),u=n.italic?n.fontSize/3:0,p=n.align,L=n.valign,T=L!==D.VALIGN_TOP||p!==D.ALIGN_LEFT||0!=d,m=0,C=0,f=0,S=0,E=[],x=E[0]=new R,w=!1,I=(x.h=0,n.italic&&(c-=n.fontSize/3),0),H=!0;function M(){x.y=C,C+=x.h+_,x.mWidth=I,I=0,x=new R,E.push(x),x.h=0,h=!(H=!(m=0))}for(s=0;s<a;s++)if(null==(i=e[s]))H||(m+=P.DIV_ELEMENT_PADDING),x.wordStartIndex=x.elements.length;else if(H=!1,i instanceof A.HTMLBrElement)M(),x.y=C,x.h=d;else{if(i._isChar()){if(f=(l=i).width+l.style.letterSpacing,S=l.height,l.isWord)h=w||"\n"===l.char,x.wordStartIndex=x.elements.length;else{if(0<E.length&&c<m+f&&0<x.wordStartIndex){var v=x.elements.length-x.wordStartIndex+1;x.elements.length=x.wordStartIndex,s-=v,M();continue}h=!1,I+=l.width}w=!1,(h=h||c<m+f)&&M(),x.minTextHeight=Math.min(x.minTextHeight,i.height)}else v=i._getCSSStyle(),l=i,r=v.padding,h=w||v.getLineElement(),f=l.width+r[1]+r[3]+v.letterSpacing,S=l.height+r[0]+r[2],w=v.getLineElement(),(h=h||c<m+f&&v.wordWrap)&&M();x.elements.push(i),x.h=Math.max(x.h,S),i.x=m,i.y=C,m+=f,x.w=m-o,x.y=C,y=Math.max(m+u,y)}if(C=x.y+x.h,T){var U=0,b=c;for(g&&0<t.width&&(b=t.width),s=0,a=E.length;s<a;s++)E[s].updatePos(0,b,s,U,p,L,d),U+=Math.max(d,E[s].h+_);C=U}return g&&(t.width=y),C>t.height&&(t.height=C),[y,C]}}var i;P.DIV_ELEMENT_PADDING=0,a.ClassUtils.regClass("laya.html.utils.Layout",P),a.ClassUtils.regClass("Laya.Layout",P),(i=t.HTMLElementType||(t.HTMLElementType={}))[i.BASE=0]="BASE",i[i.IMAGE=1]="IMAGE";class y{constructor(){this.eletype=t.HTMLElementType.BASE,this._creates(),this.reset()}static formatURL1(t,e=null){if(!t)return"null path";if(e=e||a.URL.basePath,0<t.indexOf(":"))return t;if(0<(t=null!=a.URL.customFormat?a.URL.customFormat(t):t).indexOf(":"))return t;var s=t.charAt(0);if("."===s)return a.URL._formatRelativePath(e+t);if("~"===s)return a.URL.rootPath+t.substring(1);if("d"===s){if(0===t.indexOf("data:image"))return t}else if("/"===s)return t;return e+t}_creates(){this._style=D.create()}reset(){if(this.URI=null,this.parent=null,this._style.reset(),(this._style.ower=this)._style.valign="middle",this._text&&this._text.words)for(var t,e=this._text.words,s=e.length,i=0;i<s;i++)(t=e[i])&&t.recover();return this._text=y._EMPTYTEXT,this._children&&(this._children.length=0),this._x=this._y=this._width=this._height=0,this}_getCSSStyle(){return this._style}_addChildsToLayout(r){var t=this._getWords();if(null==t&&(!this._children||0==this._children.length))return!1;if(t)for(var e=0,s=t.length;e<s;e++)r.push(t[e]);return this._children&&this._children.forEach(function(t,e,s){var i=t._style;i._enableLayout&&i._enableLayout()&&t._addToLayout(r)}),!0}_addToLayout(t){var e;!this._style||(e=this._style).absolute||(e.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))}set id(t){s.document.setElementById(t,this)}repaint(t=!1){this.parentRepaint(t)}parentRepaint(t=!1){this.parent&&this.parent.repaint(t)}set innerTEXT(t){this._text===y._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),this.repaint()}get innerTEXT(){return this._text.text}_setParent(t){t instanceof y&&(t=t,this.URI||(this.URI=t.URI),this.style&&this.style.inherit(t.style))}appendChild(t){return this.addChild(t)}addChild(t){return t.parent&&t.parent.removeChild(t),this._children||(this._children=[]),this._children.push(t),t.parent=this,t._setParent(this),this.repaint(),t}removeChild(t){if(!this._children)return null;for(var e=this._children.length,s=0;s<e;s++)if(this._children[s]==t)return this._children.splice(s,1),t;return null}static getClassName(t){return(t instanceof Function?t:t.constructor).name}destroy(){this._children&&(this.destroyChildren(),this._children.length=0),a.Pool.recover(y.getClassName(this),this.reset())}destroyChildren(){if(this._children){for(var t=this._children.length-1;-1<t;t--)this._children[t].destroy();this._children.length=0}}get style(){return this._style}_getWords(){if(!this._text)return null;var t=this._text.text;if(!t||0===t.length)return null;var e,s=this._text.words;if(s&&s.length===t.length)return s;null===s&&(this._text.words=s=[]),s.length=t.length;for(var i=this.style,r=i.font,h=0,l=t.length;h<l;h++)e=a.ILaya.Browser.measureText(t.charAt(h),r),s[h]=a.HTMLChar.create().setData(t.charAt(h),e.width,e.height||i.fontSize,i);return s}_isChar(){return!1}_layoutLater(){var t=this.style;t._type&D.ADDLAYOUTED||(t.widthed(this)&&(this._children&&0<this._children.length||null!=this._getWords())&&t.block?(P.later(this),t._type|=D.ADDLAYOUTED):this.parent&&this.parent._layoutLater())}set x(t){this._x!=t&&(this._x=t,this.parentRepaint())}get x(){return this._x}set y(t){this._y!=t&&(this._y=t,this.parentRepaint())}get y(){return this._y}get width(){return this._width}set width(t){this._width!==t&&(this._width=t,this.repaint())}get height(){return this._height}set height(t){this._height!==t&&(this._height=t,this.repaint())}_setAttributes(t,e){switch(t){case"style":this.style.cssText(e);break;case"class":this.className=e;break;case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}}set href(t){this._style&&t!=this._style.href&&(this._style.href=t,this.repaint())}get href(){return this._style?this._style.href:null}formatURL(t){return this.URI?y.formatURL1(t,this.URI?this.URI.path:null):t}set color(t){this.style.color=t}set className(t){this.style.attrs(s.document.styleSheets["."+t])}drawToGraphic(t,e,s,i){e+=this.x,s+=this.y;var r,h,l,a=this.style;if(a.paddingLeft&&(e+=a.paddingLeft),a.paddingTop&&(s+=a.paddingTop),null==a.bgColor&&!a.borderColor||t.drawRect(e,s,this.width,this.height,a.bgColor,a.borderColor,1),this.renderSelfToGraphic(t,e,s,i),this._children&&0<this._children.length)for(h=this._children.length,r=0;r<h;r++)null!=(l=this._children[r]).drawToGraphic&&l.drawToGraphic(t,e,s,i)}renderSelfToGraphic(t,e,s,i){var r,h,l,a,n=this.style,o=this._getWords();o&&(o.length,n&&(r=n.font,h=n.color,n.stroke?(a=n.stroke,a=parseInt(a),l=n.strokeColor,t.fillBorderWords(o,e,s,r,h,l,a)):t.fillWords(o,e,s,r,h),this.href&&(a=(l=o[o.length-1]).y+l.height,l.y==o[0].y?("none"!=n.textDecoration&&t.drawLine(o[0].x,a,l.x+l.width,a,h,1),(e=_.create()).rec.setTo(o[0].x,l.y,l.x+l.width-o[0].x,l.height),e.href=this.href,i.push(e)):this.workLines(o,t,i))))}workLines(t,e,s){var i="none"!=this.style.textDecoration,r=0,h=t.length,l=t[r],a=l;if(l){for(var n,r=1;r<h;r++)a=(n=t[r]).y!=l.y?(this.createOneLine(l,a,i,e,s),l=n):n;this.createOneLine(l,a,i,e,s)}}createOneLine(t,e,s,i,r){var h=e.y+e.height,s=(s&&i.drawLine(t.x,h,e.x+e.width,h,this.style.color,1),_.create());s.rec.setTo(t.x,e.y,e.x+e.width-t.x,e.height),s.href=this.href,r.push(s)}}y._EMPTYTEXT={text:null,words:null},a.ILaya.regClass(y),A.HTMLElementType=t.HTMLElementType,a.ClassUtils.regClass("laya.html.dom.HTMLElement",y),a.ClassUtils.regClass("Laya.HTMLElement",y);class r{_addToLayout(t){t.push(this)}reset(){return this}destroy(){a.Pool.recover(y.getClassName(this),this.reset())}_setParent(t){}set parent(t){}set URI(t){}set href(t){}_getCSSStyle(){return r.brStyle||(r.brStyle=new D,r.brStyle.setLineElement(!0),r.brStyle.block=!0),r.brStyle}renderSelfToGraphic(t,e,s,i){}}A.HTMLBrElement=r,a.ILaya.regClass(r),a.ClassUtils.regClass("laya.html.dom.HTMLBrElement",r),a.ClassUtils.regClass("Laya.HTMLBrElement",r);class h extends y{_creates(){}drawToGraphic(t,e,s,i){}reset(){return this}set innerTEXT(t){D.parseCSS(t,null)}get innerTEXT(){return super.innerTEXT}}a.ILaya.regClass(h),a.ClassUtils.regClass("laya.html.dom.HTMLStyleElement",h),a.ClassUtils.regClass("Laya.HTMLStyleElement",h);class l extends y{_creates(){}drawToGraphic(t,e,s,i){}reset(){return this._loader&&this._loader.off(a.Event.COMPLETE,this,this._onload),this._loader=null,this}_onload(t){this._loader&&(this._loader=null),"text/css"===this.type&&D.parseCSS(t,this.URI),this.repaint(!0)}set href(t){t&&(t=this.formatURL(t),this.URI=new a.URL(t),this._loader&&this._loader.off(a.Event.COMPLETE,this,this._onload),a.Loader.getRes(t)?"text/css"==this.type&&D.parseCSS(a.Loader.getRes(t),this.URI):(this._loader=new a.Loader,this._loader.once(a.Event.COMPLETE,this,this._onload),this._loader.load(t,a.Loader.TEXT)))}get href(){return super.href}}l._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),a.ILaya.regClass(l),a.ClassUtils.regClass("laya.html.dom.HTMLLinkElement",l),a.ClassUtils.regClass("Laya.HTMLLinkElement",l);class n extends y{constructor(){super(...arguments),this.repaintHandler=null}reset(){return super.reset(),this._style.block=!0,this._style.setLineElement(!0),this._style.width=200,this._style.height=200,this.repaintHandler=null,this.contextHeight=0,this.contextWidth=0,this}set innerHTML(t){this.destroyChildren(),this.appendHTML(t)}set width(t){var e=0===t?t!=this._width:t!=this.width;super.width=t,e&&this.layout()}appendHTML(t){A.HTMLParse.parse(this,t,this.URI),this.layout()}_addChildsToLayout(e){var t=this._getWords();if(null==t&&(!this._children||0==this._children.length))return!1;t&&t.forEach(function(t){e.push(t)});for(var s=!0,i=0,r=this._children.length;i<r;i++){var h=this._children[i];s?s=!1:e.push(null),h._addToLayout(e)}return!0}_addToLayout(t){this.layout(),this.style.absolute||t.push(this)}getBounds(){return this._htmlBounds?(this._boundsRec||(this._boundsRec=a.Rectangle.create()),this._boundsRec.copyFrom(this._htmlBounds)):null}parentRepaint(t=!1){super.parentRepaint(),this.repaintHandler&&this.repaintHandler.runWith(t)}layout(){this.style._type|=D.ADDLAYOUTED;var t,e=P.layout(this);e&&(this._htmlBounds||(this._htmlBounds=a.Rectangle.create()),(t=this._htmlBounds).x=t.y=0,t.width=this.contextWidth=e[0],t.height=this.contextHeight=e[1])}get height(){return this._height||this.contextHeight}set height(t){super.height=t}get width(){return this._width||this.contextWidth}}A.HTMLDivParser=n,a.ILaya.regClass(n),a.ClassUtils.regClass("laya.html.dom.HTMLDivParser",n),a.ClassUtils.regClass("Laya.HTMLDivParser",n);class o extends y{constructor(){super(),this.eletype=t.HTMLElementType.IMAGE}reset(){return super.reset(),this._tex&&this._tex.off(a.Event.LOADED,this,this.onloaded),this._tex=null,this._url=null,this}set src(t){var e;t=this.formatURL(t),this._url!==t&&(this._url=t,(e=this._tex=a.Loader.getRes(t))||(this._tex=e=new a.Texture,e.load(t),a.Loader.cacheTexture(t,e)),e.getIsReady()?this.onloaded():e.once(a.Event.READY,this,this.onloaded))}onloaded(){var t;this._style&&this._tex&&((t=this._style).widthed(this)||this._tex.width,t.heighted(this)||this._tex.height,t.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),t.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),this.repaint())}_addToLayout(t){this._style.absolute||t.push(this)}renderSelfToGraphic(t,e,s,i){this._tex&&t.drawImage(this._tex,e,s,this.width||this._tex.width,this.height||this._tex.height)}}A.HTMLImageElement=o,a.ILaya.regClass(o),a.ClassUtils.regClass("laya.html.dom.HTMLImageElement",o),a.ClassUtils.regClass("Laya.HTMLImageElement",o);class u{static getInstance(t){return a.Pool.getItem(u._htmlClassMapShort[t])||a.ClassUtils.getInstance(t)}static parse(t,e,s){e=(e="<root>"+(e=e.replace(/<br>/g,"<br/>"))+"</root>").replace(u.spacePattern,u.char255);e=a.Utils.parseXMLFromString(e);u._parseXML(t,e.childNodes[0].childNodes,s)}static _parseXML(t,e,s,i=null){var r,h,l,a,n,o,_;if(e.join||e.item)for(r=0,h=e.length;r<h;++r)u._parseXML(t,e[r],s,i);else if(3==e.nodeType)t instanceof A.HTMLDivParser?(null==e.nodeName&&(e.nodeName="#text"),a=e.nodeName.toLowerCase(),0<(_=e.textContent.replace(/^\s+|\s+$/g,"")).length&&(l=u.getInstance(a))&&(t.addChild(l),l.innerTEXT=_.replace(u.char255AndOneSpacePattern," "))):0<(_=e.textContent.replace(/^\s+|\s+$/g,"")).length&&((n=t)instanceof y&&t.innerTEXT&&0<t.innerTEXT.length&&((o=u.getInstance("p"))&&(t.addChild(o),n=o)),n.innerTEXT=_.replace(u.char255AndOneSpacePattern," "));else if("#comment"!=(a=e.nodeName.toLowerCase()))if(l=u.getInstance(a)){"p"==a?(t.addChild(u.getInstance("br")),l=t.addChild(l),t.addChild(u.getInstance("br"))):l=t.addChild(l),l.URI=s,l.href=i;var d=e.attributes;if(d&&0<d.length)for(r=0,h=d.length;r<h;++r){var g=d[r],c=g.nodeName,g=g.value;l._setAttributes(c,g)}u._parseXML(l,e.childNodes,s,l.href)}else u._parseXML(t,e.childNodes,s,i)}}u.char255=String.fromCharCode(255),u.spacePattern=/&nbsp;|&#160;/g,u.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),u._htmlClassMapShort={div:n,p:y,img:o,span:y,br:r,style:h,font:y,a:y,"#text":y,link:l},A.HTMLParse=u,a.ClassUtils.regClass("div",n),a.ClassUtils.regClass("p",y),a.ClassUtils.regClass("img",o),a.ClassUtils.regClass("span",y),a.ClassUtils.regClass("br",r),a.ClassUtils.regClass("style",h),a.ClassUtils.regClass("font",y),a.ClassUtils.regClass("a",y),a.ClassUtils.regClass("#text",y),a.ClassUtils.regClass("link",l),a.ClassUtils.regClass("laya.html.utils.HTMLParse",u),a.ClassUtils.regClass("Laya.HTMLParse",u);class d extends a.Sprite{constructor(){super(),this._recList=[],this._repaintState=0,this._element=new n,this._element.repaintHandler=new a.Handler(this,this._htmlDivRepaint),this.mouseEnabled=!0,this.on(a.Event.CLICK,this,this._onMouseClick)}destroy(t=!0){this._element&&this._element.reset(),this._element=null,this._doClears(),super.destroy(t)}_htmlDivRepaint(t=!1){t?this._repaintState<2&&(this._repaintState=2):this._repaintState<1&&(this._repaintState=1),0<this._repaintState&&this._setGraphicDirty()}_updateGraphicWork(){switch(this._repaintState){case 1:this._updateGraphic();break;case 2:this._refresh()}}_setGraphicDirty(){this.callLater(this._updateGraphicWork)}_doClears(){if(this._recList){for(var t=this._recList.length,e=0;e<t;e++)this._recList[e].recover();this._recList.length=0}}_updateGraphic(){this._doClears(),this.graphics.clear(!0),this._repaintState=0,this._element.drawToGraphic(this.graphics,-this._element.x,-this._element.y,this._recList);var t=this._element.getBounds();t&&this.setSelfBounds(t),this.size(t.width,t.height)}get style(){return this._element.style}set innerHTML(t){this._innerHTML!=t&&(this._repaintState=1,this._innerHTML=t,this._element.innerHTML=t,this._setGraphicDirty())}_refresh(){this._repaintState=1,this._innerHTML&&(this._element.innerHTML=this._innerHTML),this._setGraphicDirty()}set width(t){this._element.width=t}get width(){return this._element.width}set height(t){this._element.height=t}get height(){return this._element.height}get contextWidth(){return this._element.contextWidth}get contextHeight(){return this._element.contextHeight}_onMouseClick(){for(var t,e=this.mouseX,s=this.mouseY,i=this._recList.length,r=0;r<i;r++)(t=this._recList[r]).rec.contains(e,s)&&this._eventLink(t.href)}_eventLink(t){this.event(a.Event.LINK,[t])}}A.HTMLDivElement=d,A.HTMLParse=u,a.ClassUtils.regClass("laya.html.dom.HTMLDivElement",d),a.ClassUtils.regClass("Laya.HTMLDivElement",d);class g extends d{constructor(){super(),this._element._getCSSStyle().valign="middle"}set href(s){s=this._element.formatURL(s);var t=new a.Loader;t.once(a.Event.COMPLETE,null,t=>{var e=this._element.URI;this._element.URI=new a.URL(s),this.innerHTML=t,e&&(this._element.URI=e)}),t.load(s,a.Loader.TEXT)}}a.ClassUtils.regClass("laya.html.dom.HTMLIframeElement",g),a.ClassUtils.regClass("Laya.HTMLIframeElement",g),t.HTMLBrElement=r,t.HTMLDivElement=d,t.HTMLDivParser=n,t.HTMLDocument=s,t.HTMLElement=y,t.HTMLExtendStyle=e,t.HTMLHitRect=_,t.HTMLIframeElement=g,t.HTMLImageElement=o,t.HTMLLinkElement=l,t.HTMLParse=u,t.HTMLStyle=D,t.HTMLStyleElement=h,t.IHtml=A,t.Layout=P,t.LayoutLine=R}(window.Laya=window.Laya||{},Laya);