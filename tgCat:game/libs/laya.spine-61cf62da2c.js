!function(s,w){"use strict";class i extends w.Texture{constructor(e){super(e)}getImage(){return{width:this.sourceWidth,height:this.sourceHeight}}setFilters(e,t){}setWraps(e,t){}}class n extends spine.AssetManager{constructor(e="",t,s){super((e,t)=>{return s[t]=new i(e.bitmap)},e,t)}}var t=spine.Color,a=spine.SkeletonClipping,r=spine.Vector2,E=spine.Utils,b=spine.RegionAttachment,D=spine.MeshAttachment,B=spine.ClippingAttachment;class l{constructor(e,t,s){this.vertices=e,this.numVertices=t,this.numFloats=s}}class M{constructor(e=!0){this.vertexEffect=null,this.tempColor=new t,this.tempColor2=new t,this.vertexSize=8,this.twoColorTint=!1,this.renderable=new l(null,0,0),this.clipper=new a,this.temp=new r,this.temp2=new r,this.temp3=new t,this.temp4=new t,(this.twoColorTint=e)&&(this.vertexSize+=4),this.vertices=E.newFloatArray(1024*this.vertexSize)}draw(e,s=-1,n=-1,o,a){let l=this.clipper;var r=this.premultipliedAlpha;let u=this.temp,p=this.temp2,d=this.temp3,m=this.temp4,c=this.renderable,g=null,y=null;var h=e.drawOrder;let _=null;var S=e.color;let k=!1;-1==s&&(k=!0);for(let e=0,t=h.length;e<t;e++){var A=l.isClipping()?2:8;let i=h[e];if(k=0<=s&&s==i.data.index?!0:k){0<=n&&n==i.data.index&&(k=!1);var x=i.getAttachment();let t=null,s;if(x instanceof b){let e=x;c.vertices=this.vertices,c.numVertices=4,c.numFloats=A<<2,e.computeWorldVertices(i.bone,c.vertices,0,A),y=M.QUAD_TRIANGLES,g=e.uvs,t=e.region.renderObject.page.name,s=a[t],_=e.color}else{if(!(x instanceof D)){if(x instanceof B){l.clipStart(i,x);continue}l.clipEndWithSlot(i);continue}{let e=x;c.vertices=this.vertices,c.numVertices=e.worldVerticesLength>>1,c.numFloats=c.numVertices*A,c.numFloats>c.vertices.length&&(c.vertices=this.vertices=E.newFloatArray(c.numFloats)),e.computeWorldVertices(i,0,e.worldVerticesLength,c.vertices,0,A),y=e.triangles,t=e.region.renderObject.page.name,s=a[t],g=e.uvs,_=e.color}}if(null!=s){x=i.color;let h=this.tempColor;h.r=S.r*x.r*_.r,h.g=S.g*x.g*_.g,h.b=S.b*x.b*_.b,h.a=S.a*x.a*_.a,r&&(h.r*=h.a,h.g*=h.a,h.b*=h.a);A=i.data.blendMode;if(l.isClipping()){l.clipTriangles(c.vertices,c.numFloats,y,y.length,g,h,null,!1);var f=new Float32Array(l.clippedVertices),x=l.clippedTriangles;let n=[],a=[],r=[];if(null!=this.vertexEffect){let s=this.vertexEffect,i=f;for(let e=0,t=f.length;e<t;e+=8)u.x=i[e],u.y=i[e+1],d.set(i[e+2],i[e+3],i[e+4],i[e+5]),p.x=i[e+6],p.y=i[e+7],m.set(0,0,0,0),s.transform(u,p,d,m),i[e]=u.x,i[e+1]=u.y,i[e+2]=d.r,i[e+3]=d.g,i[e+4]=d.b,i[e+5]=d.a,i[e+6]=p.x,i[e+7]=p.y,n.push(i[e],-i[e+1]),r.push(i[e+2],i[e+3],i[e+4],i[e+5]),a.push(i[e+6],i[e+7])}else{let e=0;for(;Number.isFinite(f[e+6])&&Number.isFinite(f[e+7]);)n.push(f[e]),n.push(-f[e+1]),r.push(f[e+2]),r.push(f[e+3]),r.push(f[e+4]),r.push(f[e+5]),a.push(f[e+6]),a.push(f[e+7]),e+=this.vertexSize}var v;let e;switch(A){case 1:e="light";break;case 2:e="multiply";break;case 3:e="screen";break;default:e="normal"}v=(255<<24)+255*r[0]|(255*r[1]<<8)+(255*r[2]<<16),o.graphics.drawTriangles(s,0,0,n,a,new Uint16Array(x),w.Matrix.EMPTY,r[3],null,e,v)}else{let n=c.vertices,a=[],r=[],l=[];if(null!=this.vertexEffect){let i=this.vertexEffect;for(let e=0,t=0,s=c.numFloats;e<s;e+=8,t+=2)u.x=n[e],u.y=n[e+1],p.x=g[t],p.y=g[t+1],d.setFromColor(h),m.set(0,0,0,0),i.transform(u,p,d,m),n[e]=u.x,n[e+1]=u.y,n[e+2]=d.r,n[e+3]=d.g,n[e+4]=d.b,n[e+5]=d.a,n[e+6]=p.x,n[e+7]=p.y,a.push(n[e],-n[e+1]),l.push(n[e+2],n[e+3],n[e+4],n[e+5]),r.push(n[e+6],n[e+7])}else for(let e=2,t=0,s=c.numFloats;e<s;e+=8,t+=2)n[e]=h.r,n[e+1]=h.g,n[e+2]=h.b,n[e+3]=h.a,n[e+4]=g[t],n[e+5]=g[t+1],a.push(n[e-2],-n[e-1]),l.push(n[e],n[e+1],n[e+2],n[e+3]),r.push(n[e+4],n[e+5]);let e;switch(A){case 1:e="light";break;case 2:e="multiply";break;case 3:e="screen";break;default:e="normal"}x=(255<<24)+255*l[0]|(255*l[1]<<8)+(255*l[2]<<16),o.graphics.drawTriangles(s,0,0,a,r,new Uint16Array(y),w.Matrix.EMPTY,l[3],null,e,x)}}l.clipEndWithSlot(i)}else l.clipEndWithSlot(i)}l.clipEnd()}}M.QUAD_TRIANGLES=[0,1,2,2,3,0];var e=spine.TimeKeeper,h=spine.Skeleton,o=spine.AnimationState,u=spine.AnimationStateData;class p extends w.Sprite{constructor(e=null){super(),this.currentPlayTime=0,this._pause=!0,this._currAniName=null,this._playbackRate=1,this._playAudio=!0,this._soundChannelArr=[],this.trackIndex=0,e&&this.init(e),this._ins=this}init(s){let i=this;this._templet=s,this._templet._addReference(1),this.skeleton=new h(this._templet.skeletonData),this.stateData=new u(this.skeleton.data),this.state=new o(this.stateData),this.skeletonRenderer=new M(!1),this.timeKeeper=new e,this.skeletonRenderer.premultipliedAlpha=this._templet.spinePremultipliedAlpha,this.state.addListener({start:function(e){},interrupt:function(e){},end:function(e){},dispose:function(e){},complete:function(e){e.loop?i.event(w.Event.COMPLETE):(i._currAniName=null,i.event(w.Event.STOPPED))},event:function(e,t){var t={audioValue:t.data.audioPath,audioPath:t.data.audioPath,floatValue:t.floatValue,intValue:t.intValue,name:t.data.name,stringValue:t.stringValue,time:1e3*t.time,balance:t.balance,volume:t.volume};i.event(w.Event.LABEL,t),i._playAudio&&t.audioValue&&(t=w.SoundManager.playSound(s._textureDic.root+t.audioValue,1,w.Handler.create(i,i._onAniSoundStoped),null,(1e3*i.currentPlayTime-t.time)/1e3),w.SoundManager.playbackRate=i._playbackRate,t&&i._soundChannelArr.push(t))}})}play(e,t,s=!0,i=0,n=0,a,r=!0){this._playAudio=r,n/=1e3;let l=e;if((i/=1e3)<0||n<0)throw new Error("SpineSkeleton: start and end must large than zero.");if(0!==n&&n<i)throw new Error("SpineSkeleton: start must less than end.");if("number"==typeof l&&(l=this.getAniNameByIndex(e)),s||this._pause||this._currAniName!=l){this._currAniName=l,this.state.setAnimation(this.trackIndex,l,t);let e=this.state.getCurrent(this.trackIndex);e.animationStart=i,n&&n<e.animationEnd&&(e.animationEnd=n);r=e.animation.duration;this._duration=r,this._playStart=i,this._playEnd=n<=r?n:r,this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0)),this._update()}}_update(){this.timeKeeper.update();var e=this.timeKeeper.delta*this._playbackRate,t=this.state.getCurrent(this.trackIndex),e=(this.state.update(e),this.state.apply(this.skeleton),t.animationLast);this.currentPlayTime=Math.max(0,e),this.state&&this.skeleton&&(this.skeleton.updateWorldTransform(),this._ins.graphics.clear(),this.skeletonRenderer.draw(this.skeleton,-1,-1,this._ins,this._templet._textureDic))}getAnimNum(){return this._templet.skeletonData.animations.length}getAniNameByIndex(e){return this._templet.getAniNameByIndex(e)}getSlotByName(e){return this.skeleton.findSlot(e)}playbackRate(e){this._playbackRate=e}showSkinByName(e){this.showSkinByIndex(this._templet.getSkinIndexByName(e))}showSkinByIndex(e){e=this.skeleton.data.skins[e];this.skeleton.setSkin(e),this.skeleton.setSlotsToSetupPose()}stop(){this._pause||(this._pause=!0,this._currAniName=null,this.timer.clear(this,this._update),this.state.update(-this.currentPlayTime),this.currentPlayTime=0,this.event(w.Event.STOPPED),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0))}paused(){if(!this._pause&&(this._pause=!0,this.timer.clear(this,this._update),this.event(w.Event.PAUSED),0<this._soundChannelArr.length)){let s;for(let e=this._soundChannelArr.length,t=0;t<e;t++)(s=this._soundChannelArr[t]).isStopped||s.pause()}}resume(){if(this._pause&&(this._pause=!1,this.timer.frameLoop(1,this,this._update,null,!0),0<this._soundChannelArr.length)){let s;for(let e=this._soundChannelArr.length,t=0;t<e;t++)(s=this._soundChannelArr[t]).audioBuffer&&s.resume()}}_onAniSoundStoped(s){let i;for(let e=this._soundChannelArr.length,t=0;t<e;t++)((i=this._soundChannelArr[t]).isStopped||s)&&(i.isStopped||i.stop(),this._soundChannelArr.splice(t,1),e--,t--)}destroy(e=!0){super.destroy(e),this._templet._removeReference(1),this._templet=null,this.timeKeeper=null,this.skeleton=null,this.state.clearListeners(),this.state=null,this.skeletonRenderer=null,this.timer.clear(this,this._update),0<this._soundChannelArr.length&&this._onAniSoundStoped(!0)}get templet(){return this._templet}addAnimation(e,t=!1,s=0){s/=1e3;let i=e;"number"==typeof i&&(i=this.getAniNameByIndex(i)),this._currAniName=i,this.state.addAnimation(this.trackIndex,i,t,s)}setMix(e,t,s){s/=1e3;let i=e,n=("number"==typeof i&&(i=this.getAniNameByIndex(i)),t);"number"==typeof n&&(n=this.getAniNameByIndex(n)),this.stateData.setMix(i,n,s)}getBoneByName(e){return this.skeleton.findBone(e)}getSkeleton(){return this.skeleton}setSlotAttachment(e,t){this.skeleton.setAttachment(e,t)}set currentTime(e){if(this._currAniName&&this._templet){if((e/=1e3)<this._playStart||this._playEnd&&e>this._playEnd||e>this._duration)throw new Error("AnimationPlayer: value must large than playStartTime,small than playEndTime.");this.state.update(e-this.currentPlayTime),this.currentPlayTime=e}}get playState(){return this._currAniName?this._pause?p.paused:p.playing:p.stopped}}p.stopped=0,p.paused=1,p.playing=2,w.ILaya.regClass(p),w.ClassUtils.regClass("laya.layaspine.SpineSkeleton",p),w.ClassUtils.regClass("Laya.SpineSkeleton",p);class d extends w.Resource{constructor(){super(),this._isDestroyed=!1,this._textureDic={},this._layaPremultipliedAlpha=!0,this._spinePremultipliedAlpha=!1}get templet(){return this._templet}set templet(e){this._templet=e}get isDestroyed(){return this._isDestroyed}set isDestroyed(e){this._isDestroyed=e}get spinePremultipliedAlpha(){return this._spinePremultipliedAlpha}set spinePremultipliedAlpha(e){this._spinePremultipliedAlpha=e}buildArmature(){return new p(this)}getAniNameByIndex(e){e=this.skeletonData.animations[e];return e?e.name:null}getSkinIndexByName(s){var i=this.skeletonData.skins;for(let e=0,t=i.length;e<t;e++)if(i[e].name==s)return e;return-1}destroy(){this.isDestroyed=!0;let e;for(e in this._textureDic)"root"!=e&&e&&this._textureDic[e].destroy();super.destroy()}}var m=spine.AssetManager,c=spine.AtlasAttachmentLoader,g=spine.SkeletonJson,y=spine.SkeletonBinary;class _ extends d{constructor(){super(),this._textureDic={}}loadAni(e){var t=e.lastIndexOf("/")+1,s=e.slice(0,t),t=(e=e.slice(t)).replace(".json",".atlas").replace(".skel",".atlas");this._textureDic.root=s,this.clientId=s,this.atlasUrl=t,this.jsonOrSkelUrl=e,this.assetManager=new m(this._textureLoader.bind(this),s),this.assetManager.loadTextureAtlas(t),e.endsWith(".skel")?this.assetManager.loadBinary(e):this.assetManager.loadText(e),w.Laya.timer.frameOnce(1,this,this.loop)}_textureLoader(e){let t=e.url;var s=t.replace(this.clientId,"");return this._textureDic[s]=new i(e.bitmap)}loop(){this.assetManager.isLoadingComplete()?this.parseSpineAni():this.assetManager.hasErrors()?this.event(w.Event.ERROR,"load failed:"+this.assetManager.getErrors()):w.Laya.timer.frameOnce(1,this,this.loop)}parseSpineAni(){var e;this.isDestroyed?this.destroy():(e=this.assetManager.get(this.atlasUrl),e=new c(e),this.jsonOrSkelUrl.endsWith(".skel")?(this.skeletonBinary=new y(e),this.skeletonData=this.skeletonBinary.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))):(this.skeletonJson=new g(e),this.skeletonData=this.skeletonJson.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))),this.event(w.Event.COMPLETE,this))}buildArmature(){return super.buildArmature()}getAniNameByIndex(e){return super.getAniNameByIndex(e)}getSkinIndexByName(e){return super.getSkinIndexByName(e)}destroy(){super.destroy()}}var S,k=spine.AtlasAttachmentLoader,A=spine.SkeletonJson,x=spine.SkeletonBinary;class f extends d{constructor(){super(),this._textureDic={}}loadAni(e){var t=e.lastIndexOf("/")+1,s=e.slice(0,t),t=(e=e.slice(t)).replace(".json",".atlas").replace(".skel",".atlas");this._textureDic.root=s,this.pathPrefix=s,this.atlasUrl=t,this.jsonOrSkelUrl=e,this.assetManager=new n(s,new spine.Downloader,this._textureDic),this.assetManager.loadTextureAtlas(t),e.endsWith(".skel")?this.assetManager.loadBinary(e):this.assetManager.loadJson(e),w.Laya.timer.frameOnce(1,this,this.loop)}loop(){this.assetManager.isLoadingComplete()?this.parseSpineAni():this.assetManager.hasErrors()?this.event(w.Event.ERROR,"load failed:"+this.assetManager.getErrors()):w.Laya.timer.frameOnce(1,this,this.loop)}parseSpineAni(){var e;this.isDestroyed?this.destroy():(e=this.assetManager.get(this.atlasUrl),e=new k(e),this.jsonOrSkelUrl.endsWith(".skel")?(this.skeletonBinary=new x(e),this.skeletonData=this.skeletonBinary.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))):(this.skeletonJson=new A(e),this.skeletonData=this.skeletonJson.readSkeletonData(this.assetManager.get(this.jsonOrSkelUrl))),this.event(w.Event.COMPLETE,this))}buildArmature(){return super.buildArmature()}getAniNameByIndex(e){return super.getAniNameByIndex(e)}getSkinIndexByName(e){return super.getSkinIndexByName(e)}destroy(){super.destroy()}}(S=s.SpineVersion||(s.SpineVersion={})).v3_7="v3_7",S.v3_8="v3_8",S.v4_0="v4_0",(S=s.SpineFormat||(s.SpineFormat={})).json="json",S.binary="binary",s.SpineAssetManager=n,s.SpineGLTexture=i,s.SpineSkeleton=p,s.SpineSkeletonRenderer=M,s.SpineTemplet=class extends d{constructor(e){super();let t;if(e===s.SpineVersion.v3_7||e===s.SpineVersion.v3_8)t=new _;else{if(e!==s.SpineVersion.v4_0)throw new Error("传入参数错误，请与服务提供商联系");t=new f}return t}loadAni(e){}buildArmature(){return null}getAniNameByIndex(e){return null}getSkinIndexByName(e){return null}destroy(){}},s.SpineTempletBase=d,s.SpineTemplet_3_x=_,s.SpineTemplet_4_0=f}(window.Laya=window.Laya||{},Laya);