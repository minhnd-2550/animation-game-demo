!function(){let e;var t;function a(e,t){void 0===Date.prototype[e]&&(Date.prototype[e]=t)}(e=String.prototype).splitNum||(e.splitNum=function(e){let t=this.split(e);var a=[];return t.forEach(e=>{a.push(+e)}),a}),e.format||(e.format=function(){let e=this.toString(),t=0;if(e=e.replace(/(%s|%d|%%)/g,e=>"%%"===e?"%":`{${t++}}`),!arguments.length)return e;var a,i=typeof arguments[0],r="string"==i||"number"==i?arguments:arguments[0];for(a in r)e=e.replace(RegExp("\\{"+a+"\\}","gi"),r[a]);return e}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{configurable:!0,writable:!0,value:function(e,t){var a=this.toString(),a=(("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>a.length)&&(t=a.length),t-=e.length,a.lastIndexOf(e,t));return-1!==a&&a===t}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{configurable:!0,writable:!0,value:function(e,t){return!((t="number"!=typeof t?0:t)+e.length>this.length)&&-1!==this.indexOf(e,t)}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{configurable:!0,writable:!0,value:function(e,t){return this.substr(t=t||0,e.length)===e}}),String.prototype.trim||Object.defineProperty(String.prototype,"trim",{configurable:!0,writable:!0,value:function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}),e=Array.prototype,""!==Function.prototype.name&&(t=/function\ ([\w$]+)\(/,Object.defineProperty(Function.prototype,"name",{get:function(){var e=t.exec(this+"");return e&&2===e.length?e[1]:""},configurable:!0})),e=Array.prototype,Object.defineProperty(e,"remove",{configurable:!1,writable:!0,enumerable:!1,value:function(...e){e.forEach(e=>{e=this.indexOf(e);-1!=e&&this.splice(e,1)})}}),Object.defineProperty(e,"pushOnce",{configurable:!1,writable:!0,enumerable:!1,value:function(...e){e.forEach(e=>{-1==this.indexOf(e)&&this.push(e)})}}),e.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function(){var e=void 0===arguments[0]?1:Number(arguments[0])||0,a=[],i=a.forEach,r=function(e,t){i.call(e,function(e){0<t&&Array.isArray(e)?r(e,t-1):a.push(e)})};return r(this,e),a}}),e.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){return Array.prototype.map.apply(this,arguments).flat(1)}}),Math.range=function(e,t,a){var i=Math.max(t,a),t=Math.min(t,a);return Math.min(Math.max(e,t),i)},Math.randRange=function(e,t){return Math.floor(Math.random()*(t-e+1)+e)},Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),a("addMilliseconds",function(e){return Date.addMilliseconds(this,e)}),a("addSeconds",function(e){return Date.addSeconds(this,e)}),a("addMinutes",function(e){return Date.addMinutes(this,e)}),a("addHours",function(e){return Date.addHours(this,e)}),a("addDays",function(e){return Date.addDays(this,e)}),a("getDateZeroTime",function(){return Date.getDateZeroTime(this)}),a("clone",function(){return new Date(this.valueOf())}),a("between",function(e,t){return this.valueOf()>=e.valueOf()&&this.valueOf()<=t.valueOf()}),a("compareTo",function(e){return Date.compare(this,e)}),a("equals",function(e){return Date.equals(this,e)}),a("equalsDay",function(e){return Date.equalsDay(this,e)}),a("getWeekDay",function(){return Date.getWeekDay(this)}),a("isToday",function(){return Date.equalsDay(this,Date.newDate())}),a("isAfter",function(e){return e=e||new Date,0<this.compareTo(e)}),a("isBefore",function(e){return e=e||new Date,this.compareTo(e)<0}),a("isWeekend",function(e){return this.getDay()%6==0}),a("getDaysBetween",function(e){return(e.clone().valueOf()-this.valueOf())/864e5|0}),a("getHoursBetween",function(e){return(e.clone().valueOf()-this.valueOf())/36e5|0}),a("getMinutesBetween",function(e){return(e.clone().valueOf()-this.valueOf())/6e4|0}),a("getSecondsBetween",function(e){return(e.clone().valueOf()-this.valueOf())/1e3|0}),a("getMillisecondsBetween",function(e){return e.clone().valueOf()-this.valueOf()|0}),a("getMonthsBetween",function(e){Math.abs(+this/864e5-+e/864e5);for(var t=new Date(+e<+this?+e:+this),a=new Date(+this<e?+e:+this),i=0;+t<+a;)i++,t=t.addDays(30);return i-Math.abs(+t/864e5-+a/864e5)/31}),Date.compare=function(e,t){return e.valueOf()<t.valueOf()?-1:e.valueOf()>t.valueOf()?1:0},Date.equals=function(e,t){return e.valueOf()===t.valueOf()},Date.isLeapYear=function(e){return 29===new Date(e,1,29).getDate()};var i=[31,28,31,30,31,30,31,31,30,31,30,31];Date.getDaysInMonth=function(e,t){return 1===t?Date.isLeapYear(e)?29:28:i[t]},Date.addMilliseconds=function(e,t){return Date.newDate(e.getTime()+t)},Date.addSeconds=function(e,t){return Date.newDate(e.getTime()+1e3*t)},Date.addMinutes=function(e,t){return Date.newDate(e.getTime()+6e4*t)},Date.addHours=function(e,t){return Date.newDate(e.getTime()+36e5*t)},Date.addDays=function(e,t){return Date.newDate(e.getTime()+864e5*t)},Date.isInSameWeek=function(e,t){var a=this._serverMondayZeroTimeMSec;return Math.floor((e.getTime()-a)/6048e5)==Math.floor((t.getTime()-a)/6048e5)},Date.getWeekDay=function(e){var t=this._serverMondayZeroTimeMSec-3024e8,e=Math.floor((e.getTime()-t)/864e5)%7+1;return e=7==e?0:e},Date.equalsDay=function(e,t){var a=this._serverTodayZeroTimeMSec;return Math.floor((e.getTime()-a)/864e5)==Math.floor((t.getTime()-a)/864e5)},Date.getTodayZeroTime=function(){return new Date(this._serverTodayZeroTimeMSec)},Date.getMondayZeroTime=function(){return new Date(this._serverMondayZeroTimeMSec)},Date.getDateZeroTime=function(e){var e=Date.newDate(e).getTime(),t=0,a=this._serverTodayZeroTimeMSec;return a<=e?a+=864e5*(t=Math.floor((e-a)/864e5)):a-=a-864e5*(t=Math.floor((a-e)/864e5))==e?864e5*t:864e5*(t+1),Date.newDate(a)},Date.setServerDate=function(e,t){this._serverTodayZeroTimeMSec=new Date(1e3*e).getTime(),this._serverMondayZeroTimeMSec=new Date(1e3*t).getTime()},Date.setStandard=function(e,t){var a=this,i=(new Date).getTimezoneOffset();a._serverOffset=60*(t=t||i)*1e3,a._localOffset=60*i*1e3,a._serverDateMSec=(e?new Date(1e3*e):new Date).getTime(),a._dateToGotServerDateMSec=(new Date).getTime()},Date.getServerTime=function(e){var t=this;if(t._serverDateMSec||t.setStandard(),e){if("number"==typeof e&&!isNaN(e))return new Date(e);e=new Date(e).getTime();return new Date(e+t._localOffset-t._serverOffset)}e=(new Date).getTime()+t._localOffset-t._serverOffset,e=t._serverDateMSec+e-t._dateToGotServerDateMSec;return new Date(e)},Date.newDate=function(e){if(e)return new Date(e);this._serverDateMSec||this.setStandard();e=(new Date).getTime(),e=this._serverDateMSec+e-this._dateToGotServerDateMSec;return new Date(e)}}(),function(){let e,l=((e=Laya.LoaderManager.prototype).loadP=function(e,i,r,s,n,o,h,l){return new Promise((t,a)=>{this.load(e,Laya.Handler.create(this,e=>{e?t(e):a({message:"load error"})}),i,r,s,n,o,h,l)})},Laya.Scene.loadP=function(i){return new Promise((t,a)=>{Laya.Scene.load(i,Laya.Handler.create(this,e=>{e?t(e):a({message:`load scene ${i} error`})}))})},Laya.Scene.openP=function(i,e,r){return new Promise((t,a)=>{Laya.Scene.open(i,e,r,Laya.Handler.create(this,e=>{e?t(e):a({message:`open scene ${i} error`})}))})},(e=Laya.AutoBitmap.prototype).changeSource=function(){this._isChanged=!1;var e,t,a,i,r,s=this._source;s&&s.bitmap&&(e=this.width,t=this.height,a=this._sizeGrid,i=s.sourceWidth,r=s.sourceHeight,this.clear(),!a||i===e&&r===t?(i=this._createDrawTexture(s,this._offset?this._offset[0]:0,this._offset?this._offset[1]:0,e,t,null,1,null,null,this.uv))&&this._setDrawGridCmd(i):(r=Laya.Draw9GridTexture.create(s,0,0,e,t,a),this._setDrawGridCmd(r)),this._repaint())},(e=Laya.Image.prototype).setSource=function(e,t=null){this.destroyed||e===this._skin&&t&&(this.source=t,this.onCompResize())},(e=Laya.Mesh2D.prototype).configVAO=function(e){if(!this._applied){this._applied=!0,this._vao||(this._vao=new Laya.BufferState2D),this._vao.bind(),this._vb._bindForVAO();for(var t=this._attribInfo.length/3,a=0,i=0;i<t;i++){var r=this._attribInfo[a+1],s=this._attribInfo[a],n=this._attribInfo[a+2];e.enableVertexAttribArray(i),e.vertexAttribPointer(i,r,s,!1,this._stride,n),a+=3}this._vao.unBind()}},e.useMesh=function(e){this._applied||this.configVAO(e),this._vao.bind(),this._vb.bind(),this._ib._bind_upload()||this._ib._bindForVAO(),this._vb._bind_upload()||this._vb.bind()},(e=Laya.WorkerLoader.prototype)._loadImage=function(t){var a,i=this;let r=i.type;this._useWorkerLoader&&Laya.WorkerLoader._enable?(t=Laya.URL.formatURL(t),a=function(e){Laya.WorkerLoader.I.off(t,i,a),e?(e=e,"nativeimage"!==r&&(e.src=t),i.onLoaded(e)):Laya.WorkerLoader._preLoadFun.call(i,t)},Laya.WorkerLoader.I.on(t,i,a),Laya.WorkerLoader.I.loadImage(t)):Laya.WorkerLoader._preLoadFun.call(i,t)},(e=Laya.EventDispatcher.prototype).event=function(e,t=null){if(!this._events||!this._events[e])return!1;var a=this._events[e];if(a.run)a.once&&delete this._events[e],null!=t?a.runWith(t):a.run();else{for(var i=0,r=a.length;i<r;i++){var s=a[i];s&&(null!=t?s.runWith(t):s.run()),s&&!s.once||(a.splice(i,1),i--,r--)}0===a.length&&this._events&&this._events[e]&&!this._events[e].run&&delete this._events[e]}return!0},(e=Laya.LoaderManager.prototype).load),g=(e.load=function(e,t=null,a=null,i=null,r=1,s=!0,n=null,o=!1,h=Laya.WorkerLoader.enable){e instanceof Array||"ktx"==Laya.Utils.getFileExtension(e)&&(h=!1),l.call(this,e,t,a,i,r,s,n,o,h)},(e=Laya.Loader.prototype).onLoaded);e.onLoaded=function(i=null){var r,s=this._type;if("htmlimage"===s){if(i instanceof ArrayBuffer){let e;switch(r=Laya.Utils.getFileExtension(this._url)){case"ktx":e=Laya.TextureFormat.ETC1RGB;break;case"pvr":e=Laya.TextureFormat.PVRTCRGBA_4BPPV;break;default:return void console.error("unknown format",r)}let t=new Laya.Texture2D(0,0,e,!1,!1);return t.wrapModeU=Laya.WarpMode.Clamp,t.wrapModeV=Laya.WarpMode.Clamp,t.setCompressData(i),t._setCreateURL(this.url),void this.complete(t)}let e=new Laya.Texture2D(i.width,i.height,1,!1,!1);return e.wrapModeU=Laya.WarpMode.Clamp,e.wrapModeV=Laya.WarpMode.Clamp,e.loadImageSource(i,!0),e._setCreateURL(i.src),void this.complete(e)}if(s==Laya.Loader.ATLAS){if(i.frames){var a=[];if(!this._data){if((this._data=i).meta&&i.meta.image)for(var a=i.meta.image.split(","),s=0<=this._url.indexOf("/")?"/":"\\",s=this._url.lastIndexOf(s),n=0<=s?this._url.substr(0,s+1):"",o=0,h=a.length;o<h;o++)a[o]=n+a[o];else a=[this._url.replace(".json",".png")];a.reverse(),i.toLoads=a,i.pics=[]}this.event(Laya.Event.PROGRESS,.3+1/a.length*.6);let e=a.pop();Laya.Loader.checkUseKtx(e)&&(e=e.replace(".png",".ktx")),e=Laya.URL.formatURL(e);s=Laya.Utils.getFileExtension(e);let t=Laya.Loader.IMAGE;return"pvr"!=s&&"ktx"!=s||(t=Laya.Loader.BUFFER),this._loadResourceFilter(t,e)}{let a;if(!(i instanceof Laya.Texture2D))if(i instanceof ArrayBuffer){a=this._http?this._http.url:this._url;let e;switch(r=Laya.Utils.getFileExtension(a)){case"ktx":e=Laya.TextureFormat.ETC1RGB;break;case"pvr":e=Laya.TextureFormat.PVRTCRGBA_4BPPV;break;default:return void console.error("unknown format",r)}let t=new Laya.Texture2D(0,0,e,!1,!1);t.wrapModeU=Laya.WarpMode.Clamp,t.wrapModeV=Laya.WarpMode.Clamp,t.setCompressData(i),t._setCreateURL(a),i=t}else{let e=new Laya.Texture2D(i.width,i.height,1,!1,!1);e.wrapModeU=Laya.WarpMode.Clamp,e.wrapModeV=Laya.WarpMode.Clamp,e.loadImageSource(i,!0),e._setCreateURL(i.src),i=e}if(this._data.pics.push(i),0<this._data.toLoads.length){this.event(Laya.Event.PROGRESS,.3+1/this._data.toLoads.length*.6);var s=Laya.URL.formatURL(this._data.toLoads.pop()),t=Laya.Utils.getFileExtension(s);let e=Laya.Loader.IMAGE;return"pvr"!=t&&"ktx"!=t||(e=Laya.Loader.BUFFER),this._loadResourceFilter(e,s)}var e,l=this._data.frames,t=this._url.split("?")[0],u=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:t.substring(0,t.lastIndexOf("."))+"/",c=this._data.pics,s=Laya.URL.formatURL(this._url),f=Laya.Loader.atlasMap[s]||(Laya.Loader.atlasMap[s]=[]);f.dir=u;if(this._data.meta&&this._data.meta.scale&&1!=this._data.meta.scale)for(var d in e=parseFloat(this._data.meta.scale),l){var _,p=l[d],y=c[p.frame.idx||0];a=u+d,y.scaleRate=e,_=Laya.Texture._create(y,p.frame.x,p.frame.y,p.frame.w,p.frame.h,p.spriteSourceSize.x,p.spriteSourceSize.y,p.sourceSize.w,p.sourceSize.h,Laya.Loader.getRes(a)),Laya.Loader.cacheTexture(a,_),_.url=a,f.push(a)}else for(d in l)y=c[(p=l[d]).frame.idx||0],a=u+d,_=Laya.Texture._create(y,p.frame.x,p.frame.y,p.frame.w,p.frame.h,p.spriteSourceSize.x,p.spriteSourceSize.y,p.sourceSize.w,p.sourceSize.h,Laya.Loader.getRes(a)),Laya.Loader.cacheTexture(a,_),_.url=a,f.push(a);delete this._data.pics,this.complete(this._data)}}else g.call(this,i)},Laya.Loader.checkUseKtx=function(e){if(!Laya.Browser.onAndroid&&!Laya.Browser.onIOS)return!1;var t=Laya.LayaGL.layaGPUInstance;if(t&&t._compressedTextureASTC&&(t._compressedTextureASTC.COMPRESSED_RGBA_ASTC_4x4_KHR||t._compressedTextureASTC.COMPRESSED_RGBA_ASTC_6x6_KHR)&&(e=e.replace(".png",".ktx"),(Laya.Loader._ktxDic||{})[e]))return!0;return!1},(e=Laya.Text.prototype)._renderText=function(){var e,t=this.padding.slice(0),a=(Laya.Render.isConchApp&&Laya.Browser.onAndroid&&(this.font&&"Arial"!=this.font||(t[0]-=3)),this._lines.length),i=(this.overflow!=Laya.Text.VISIBLE&&(a=Math.min(a,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1)),this.scrollY/(this._charSize.height+this.leading)|0),r=this.graphics,s=(r.clear(!0),this._getContextFont()),n=(Laya.Browser.context.font=s,t[3]),o="left",h=this._lines,l=this.leading+this._charSize.height,u=this._style.currBitmapFont,c=(u&&(l=this.leading+u.getMaxHeight()),t[0]);!u&&0<this._width&&this._textWidth<=this._width&&("right"==this.align?(o="right",n=this._width-t[1]):"center"==this.align&&(o="center",n=.5*this._width+t[3]-t[1]));let f=1;u&&u.autoScaleSize&&(f=u.fontSize/this.fontSize),0<this._height&&("middle"===(d=this._textHeight>this._height?"top":this.valign)?c=.5*(this._height-a/f*l)+t[0]-t[2]:"bottom"===d&&(c=this._height-a/f*l-t[2])),this._clipPoint&&(r.save(),u&&u.autoScaleSize?(d=this._width?this._width-t[3]-t[1]:this._textWidth,e=this._height?this._height-t[0]-t[2]:this._textHeight,d*=f,e*=f,r.clipRect(t[3],t[0],d,e)):r.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight),this.repaint());for(var d,_=this._style,p=_.asPassword,y=("prompt"in this&&this.prompt==this._text&&(p=!1),0),g=0,m=Math.min(this._lines.length,a+i)||1,v=i;v<m;v++){var L,D=h[v];if(p)for(var w=D.length,D="",x=w;0<x;x--)D+="●";null==D&&(D=""),y=n-(this._clipPoint?this._clipPoint.x:0),g=c+l*v-(this._clipPoint?this._clipPoint.y:0),this.underline&&this._drawUnderline(o,y,g,v),u?(w=this.width,u.autoScaleSize&&(w=this.width*f,y*=f,g*=f),u._drawText(D,this,y,g,this.align,w)):(this._words||(this._words=[]),this._words.length>v-i?L=this._words[v-i]:(L=new Laya.WordText,this._words.push(L)),L.setText(D),L.splitRender=this._singleCharRender,_.stroke?r.fillBorderText(L,y,g,s,this.color,o,_.stroke,_.strokeColor):r.fillText(L,y,g,s,this.color,o))}u&&u.autoScaleSize&&(d=1/f,this.scale(d,d)),this._clipPoint&&r.restore(),this._startX=n,this._startY=c},e._parseLine=function(e,t){var a=this._lines,i=0,r=0,s=0,n=0;if((r=this._getTextWidth(e))<=t)return a.push(e),void this._lineWidths.push(r);r=this._charSize.width,i=Math.floor(t/r),s=r=this._getTextWidth(e.substring(0,i=0==i?1:i));let o=[3633,3635,3636,3637,3638,3639,3655,3660,3661,3662,3640,3641,3656,3657,3658,3659];for(var h=i,l=e.length;h<l;h++)if(-1==o.indexOf(e.charCodeAt(h))&&t<(s+=r=this._getTextWidth(e.charAt(h))))if(this.wordWrap){var u=e.substring(n,h),c=u.charCodeAt(u.length-1);if(!(c<19968||40869<c)||(c=/(?:[^\s\!-\/])+$/.exec(u))&&(h=c.index+n,0==c.index?h+=u.length:u=e.substring(n,h)),a.push(u),this._lineWidths.push(s-r),!((n=h)+i<l)){a.push(e.substring(n,l)),this._lineWidths.push(this._getTextWidth(a[a.length-1])),n=-1;break}h+=i,s=r=this._getTextWidth(e.substring(n,h)),h--}else if(this.overflow==Laya.Text.HIDDEN)return a.push(e.substring(0,h)),void this._lineWidths.push(this._getTextWidth(a[a.length-1]));this.wordWrap&&-1!=n&&(a.push(e.substring(n,l)),this._lineWidths.push(this._getTextWidth(a[a.length-1])))},(e=Laya.ScrollBar.prototype).loop=function(){if(!this.disableDrag){var e=Laya.ILaya.stage.mouseY,t=Laya.ILaya.stage.mouseX;if(this._lastOffset=this.isVertical?e-this._lastPoint.y:t-this._lastPoint.x,this._clickOnly){if(!(1<Math.abs(this._lastOffset*(this.isVertical?Laya.ILaya.stage._canvasTransform.getScaleY():Laya.ILaya.stage._canvasTransform.getScaleX()))))return;if(this._clickOnly=!1,this.checkTriggers())return;this._offsets||(this._offsets=[]),this._offsets.length=0,this._target.mouseEnabled=!1,!this.hide&&this.autoHide&&(this.alpha=1,this.visible=!0),this.event(Laya.Event.START)}else if(this.checkTriggers())return;this._offsets.push(this._lastOffset),this._lastPoint.x=t,this._lastPoint.y=e,0!==this._lastOffset&&(this._checkElastic||(0<this.elasticDistance?this._checkElastic||0==this._lastOffset||(0<this._lastOffset&&this._value<=this.min||this._lastOffset<0&&this._value>=this.max?(this._isElastic=!0,this._checkElastic=!0):this._isElastic=!1):this._checkElastic=!0),this._isElastic?this._value<=this.min?0<this._lastOffset?this.value-=this._lastOffset*Math.max(0,1-(this.min-this._value)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value>=this.min&&(this._checkElastic=!1)):this._value>=this.max&&(this._lastOffset<0?this.value-=this._lastOffset*Math.max(0,1-(this._value-this.max)/this.elasticDistance):(this.value-=.5*this._lastOffset,this._value<=this.max&&(this._checkElastic=!1))):this.value-=this._lastOffset)}}}();